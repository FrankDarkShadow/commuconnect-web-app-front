<div class="dashboard-container">
  <main class="contenido">
    <div class="bloque-central">
      <h2 class="titulo-comunidad">Reservar sesión presencial</h2>

      <!-- 1) Distrito -->
      <div style="margin-bottom: 1.5rem;">
        <label><strong>Filtrar por distrito:</strong></label>
        <select
          [(ngModel)]="distritoSeleccionado"
          (change)="filtrarPorDistrito()"
          class="form-select"
        >
          <option [ngValue]="null">Seleccionar distrito</option>
          <option *ngFor="let d of distritos" [ngValue]="d">
            {{ d.nombre }}
          </option>
        </select>
      </div>

      <!-- tarjetas de distrito -->
      <div class="tarjetas" *ngIf="!distritoSeleccionado">
        <div
          class="tarjeta"
          *ngFor="let d of distritos"
          (click)="distritoSeleccionado = d; filtrarPorDistrito()"
        >
          <img [src]="d.imagen || 'ruta-default.jpg'" [alt]="d.nombre" />
          <h4>{{ d.nombre }}</h4>
        </div>
      </div>

      <!-- 2) Local -->
      <div *ngIf="distritoSeleccionado" style="margin-bottom: 1rem;">
        <label><strong>Filtrar por local:</strong></label>
        <select
          [(ngModel)]="localSeleccionado"
          (change)="seleccionarLocal(localSeleccionado)"
          class="form-select"
        >
          <option [ngValue]="null">Seleccionar local</option>
          <option *ngFor="let local of localesFiltrados" [ngValue]="local">
            {{ local.nombre }}
          </option>
        </select>
      </div>

      <!-- tarjetas de local -->
      <div class="tarjetas" *ngIf="distritoSeleccionado && !localSeleccionado">
        <div
          class="tarjeta"
          *ngFor="let local of localesFiltrados"
          (click)="seleccionarLocal(local)"
        >
          <img [src]="local.imagen" [alt]="local.nombre" />
          <h4>{{ local.nombre }}</h4>
          <p>{{ local.direccion_detallada }}</p>
        </div>
      </div>

      <!-- 3) Fechas -->
      <div *ngIf="localSeleccionado && fechasFiltradas.length">
        <label><strong>Fechas disponibles:</strong></label>
        <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:0.5rem;">
          <button
            *ngFor="let fecha of fechasFiltradas"
            class="btn btn-outline-secondary"
            (click)="seleccionarFecha(fecha)"
            [class.seleccionado]="fechaSeleccionada === fecha"
          >
            {{ fecha }}
          </button>
        </div>
      </div>

      <!-- 4) Horas -->
      <div *ngIf="fechaSeleccionada && horasFiltradas.length" style="margin-top:1.5rem;">
        <label><strong>Horas disponibles:</strong></label>
        <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:0.5rem;">
          <button
            *ngFor="let hora of horasFiltradas"
            class="btn btn-outline-secondary"
            (click)="seleccionarHora(hora)"
            [class.seleccionado]="horaSeleccionada === hora"
          >
            {{ hora }}
          </button>
        </div>
      </div>

      <!-- 5) Sesiones detalladas -->
      <div *ngIf="sesionesDisponibles.length" style="margin-top:1.5rem;">
        <label><strong>Sesiones disponibles:</strong></label>
        <div class="tarjetas" style="margin-top:0.5rem;">
          <div class="tarjeta" *ngFor="let s of sesionesDisponibles">
            <h4>
              {{ s.fecha }} • {{ s.hora_inicio }} – {{ s.hora_fin }}
            </h4>
            <p>Responsable: {{ s.responsable }}</p>
            <p>Vacantes: {{ s.vacantes_libres }} / {{ s.vacantes_totales }}</p>
            <button class="btn-verde" (click)="reservarSesion(s)">
              Reservar
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
